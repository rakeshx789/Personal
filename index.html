<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Navaratri 2025 Invitation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#ff6b6b,#ffa500,#ff1493);
      text-align: center;
      padding: 18px;
    }
    h1 { color: white; margin-bottom: 6px; }
    .upload-btn {
      padding: 12px 26px; border: none; border-radius: 25px;
      background: #ff5722; color: white; font-size: 16px; cursor: pointer;
    }
    .upload-btn:hover { background:#e64a19; }
    canvas {
      margin-top: 20px; max-width: 100%; border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
    }
    .download-btn {
      margin-top: 12px; padding: 10px 20px; border: none; border-radius: 20px;
      background: #4CAF50; color: white; font-size: 15px; cursor: pointer;
    }
    .hint { color: #fff; margin-top:6px; opacity:0.95; }
    .controls {
      margin-top: 10px;
      color: #fff;
    }
    .controls label {
      margin: 0 10px;
      display: inline-block;
    }
    .controls input {
      vertical-align: middle;
    }
  </style>

  <!-- stylish script font -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
</head>
<body>
  <h1>ðŸŒ¸ Navaratri 2025 Invitation Generator ðŸŒ¸</h1>
  <p class="hint">Upload a single photo â€” adjust zoom/move if needed. Wide photos will get blurred background fill.</p>

  <input id="fileInput" type="file" accept="image/*" style="display:none">
  <button class="upload-btn" onclick="document.getElementById('fileInput').click()">ðŸ“¤ Upload Photo</button>

  <div id="preview"></div>

  <script>
  // ===== CONFIG =====
  const TEMPLATE_SRC = 'template.png'; // make sure template.png is in same folder

  const FRAME = { x: 2450, y: 400, w: 900, h: 1200, r: 50 };
  const NAME_POS = { x: 2835, y: 1750, maxWidth: 900, maxFont: 140 };

  let currentPhoto, template;
  let adjust = { scale: 1, offsetX: 0, offsetY: 0 };

  const input = document.getElementById('fileInput');
  input.addEventListener('change', handleFile, false);

  function handleFile(e) {
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const name = (f.name || 'Guest').split('.').slice(0, -1).join('.') || 'Guest';
    const reader = new FileReader();
    reader.onload = (ev) => generateInvitation(ev.target.result, name);
    reader.readAsDataURL(f);
  }

  function generateInvitation(photoDataUrl, name) {
    template = new Image();
    template.src = TEMPLATE_SRC;
    currentPhoto = new Image();
    currentPhoto.src = photoDataUrl;

    template.onload = () => {
      currentPhoto.onload = () => {
        adjust = { scale: 1, offsetX: 0, offsetY: 0 };
        redraw(template, currentPhoto, name);
      };
    };
  }

  function redraw(template, photo, name) {
    const canvas = document.createElement('canvas');
    canvas.width = template.width;
    canvas.height = template.height;
    const ctx = canvas.getContext('2d');

    ctx.drawImage(template, 0, 0, canvas.width, canvas.height);

    const f = FRAME;
    const targetAR = f.w / f.h;
    const imgAR = photo.width / photo.height;

    ctx.save();
    roundRectPath(ctx, f.x, f.y, f.w, f.h, f.r);
    ctx.clip();

    if (Math.abs(imgAR - targetAR) > 0.6) {
      // blurred background for wide/tall images
      ctx.filter = "blur(30px)";
      ctx.drawImage(photo, f.x, f.y, f.w, f.h);
      ctx.filter = "none";
    }

    // Apply zoom and offset
    const baseW = f.w * adjust.scale;
    const baseH = baseW / imgAR;
    const cx = f.x + f.w / 2 + adjust.offsetX;
    const cy = f.y + f.h / 2 + adjust.offsetY;

    ctx.drawImage(photo, cx - baseW/2, cy - baseH/2, baseW, baseH);
    ctx.restore();

    // border strokes
    ctx.lineWidth = 18;
    ctx.strokeStyle = 'rgba(196,35,95,0.95)';
    roundRectPath(ctx, f.x, f.y, f.w, f.h, f.r);
    ctx.stroke();

    ctx.lineWidth = 6;
    ctx.strokeStyle = 'rgba(255,255,255,0.9)';
    roundRectPath(ctx, f.x+8, f.y+8, f.w-16, f.h-16, f.r-8);
    ctx.stroke();

    // Draw name
    const fontSize = fitTextToWidth(ctx, name, "'Great Vibes', cursive", NAME_POS.maxWidth, NAME_POS.maxFont);
    ctx.font = `${fontSize}px 'Great Vibes', cursive`;
    ctx.fillStyle = '#fff';
    ctx.shadowColor = 'rgba(0,0,0,0.6)';
    ctx.shadowBlur = 8;
    ctx.textAlign = 'center';
    ctx.fillText(name, NAME_POS.x, NAME_POS.y);

    const preview = document.getElementById('preview');
    preview.innerHTML = '';
    preview.appendChild(canvas);
    showAdjustControls(name);

    // Download button
    const btn = document.createElement('button');
    btn.className = 'download-btn';
    btn.innerText = 'ðŸ“¥ Download Invitation';
    btn.onclick = () => {
      const a = document.createElement('a');
      a.download = `${name}_Navaratri_Invitation.png`;
      a.href = canvas.toDataURL('image/png');
      a.click();
    };
    preview.appendChild(btn);
  }

  function showAdjustControls(name) {
    const preview = document.getElementById('preview');
    const controls = document.createElement('div');
    controls.className = 'controls';
    controls.innerHTML = `
      <label>Zoom: <input type="range" id="zoomRange" min="0.5" max="2" step="0.05" value="${adjust.scale}"></label>
      <label>Move X: <input type="range" id="moveX" min="-400" max="400" step="5" value="${adjust.offsetX}"></label>
      <label>Move Y: <input type="range" id="moveY" min="-400" max="400" step="5" value="${adjust.offsetY}"></label>
    `;
    preview.appendChild(controls);

    document.getElementById('zoomRange').oninput = (e) => {
      adjust.scale = parseFloat(e.target.value);
      redraw(template, currentPhoto, name);
    };
    document.getElementById('moveX').oninput = (e) => {
      adjust.offsetX = parseInt(e.target.value);
      redraw(template, currentPhoto, name);
    };
    document.getElementById('moveY').oninput = (e) => {
      adjust.offsetY = parseInt(e.target.value);
      redraw(template, currentPhoto, name);
    };
  }

  function fitTextToWidth(ctx, text, fontFamily, maxWidth, startSize) {
    let size = startSize;
    do {
      ctx.font = `${size}px ${fontFamily}`;
      const w = ctx.measureText(text).width;
      if (w <= maxWidth) break;
      size -= 2;
    } while (size > 24);
    return size;
  }

  function roundRectPath(ctx, x, y, w, h, r) {
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.lineTo(x + w - r, y);
    ctx.quadraticCurveTo(x + w, y, x + w, y + r);
    ctx.lineTo(x + w, y + h - r);
    ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
    ctx.lineTo(x + r, y + h);
    ctx.quadraticCurveTo(x, y + h, x, y + h - r);
    ctx.lineTo(x, y + r);
    ctx.quadraticCurveTo(x, y, x + r, y);
    ctx.closePath();
  }
  </script>
</body>
</html>
